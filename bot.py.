import mpesa

consumer_key = "skJ7v36t4v13SV7T154wtI8yzzAIAabYNQZnRalxdbMvGKpq"
consumer_secret = "XcTU017mQGHXwyVNcAluM0dctKo92I4pwXXBCaJHrcQofGHA0u0BbWLZx5gzaaop"
# Generate access token
access_token = mpesa_api.authenticate()

# Initiate payment (example)
payment_response = mpesa_api.list_payment(
    BusinessShortCode="8750991",
    Password="Munga#254254",
    Timestamp="20251120103030",
    TransactionType="Customerbuygoodsonline",
    Amount=500,
    PartyA="phone-number",
    PartyB="8750991",
    PhoneNumber="phone-number",
    CallBackURL="YOUR_CALLBACK_URL",
    AccountReference="payment-for-service",
    TransactionDesc="DESCRIPTION"
)
import telegram
from telegram.ext import Updater, CommandHandler

TOKEN = '8464771296:AAFoBqpNty8c4YndrAZQLgu-Dtv4BNRI3tA'

def start(update, context):
    context.bot.send_message(chat_id=update.effective_user.id, text='Hello! welcome to prosperous market Watch this video: https://vm.tiktok.com/ZMH3be3UNkXSJ-lrzh9/')
def register_user(update, context):
    # Get user input
    name = update.message.text  # Replace with your actual input field
    email = context.user_data['email']  # Replace with your actual input field
    phone_number = context.user_data['phone_number']  # Replace with your actual input field
    telegram_username = update.effective_user.username

    # Store user data in a database
    # Replace with your actual database connection code
    import sqlite3
    conn = sqlite3.connect('your_database.db')
    cursor = conn.cursor()

    # Create a table to store user data if it doesn't exist
    # Replace with your actual table schema
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS users
        (id INTEGER PRIMARY KEY, name TEXT, email TEXT, phone_number TEXT, telegram_username TEXT, payment_status TEXT)
    ''')

    # Insert user data into the table
    cursor.execute('INSERT INTO users (name, email, phone_number, telegram_username, payment_status) VALUES (?, ?, ?, ?, ?)',
                  (name, email, phone_number, telegram_username, 'pending'))
    conn.commit()
    conn.close()

    # Send a message to the user to confirm registration
    update.message.reply_text('Registration successful! Please complete payment to access our TikTok videos.')
updater = Updater(TOKEN, use_context=True)
dispatcher = updater.dispatcher
dispatcher.add_handler(CommandHandler('start', start))
updater.start_polling()
